<!DOCTYPE html>
<html>
	<head>
		<title>ArcheBase</title>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="style.css" />
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="feed.js"></script>	
		<script type="text/javascript" src="archebase-tooltips.js"></script>
				
		<script type="text/javascript">
			var GLOBAL_PAGE = 1;
			var GLOBAL_TREES = '';
			var classList = {"Nocturne":[4,8,7],"Sorrowsong":[4,8,9],"Lorebreaker":[4,8,0],"Dark Aegis":[4,8,2],"Tombcaller":[4,8,1],"Requiem":[4,8,6],"Gravesinger":[4,8,5],"Phantasm":[4,8,3],"Templar":[2,3,9],"Tomb Warden":[2,3,8],"Skullknight":[2,3,4],"Nightblade":[2,3,7],"Abolisher":[2,3,0],"Dreambreaker":[2,3,1],"Thaumaturge":[2,3,6],"Bastion":[2,3,5],"Confessor":[7,8,9],"Blade Dancer":[7,8,0],"Nightbearer":[7,8,2],"Nightwitch":[7,8,1],"Spellsinger":[7,8,6],"Ebonsong":[7,8,5],"Exorcist":[7,8,3],"Scion":[2,6,9],"Bloodthrall":[8,9,0],"Caretaker":[8,9,2],"Athame":[8,9,1],"Gypsy":[8,9,6],"Soulsong":[8,9,5],"Exorcist":[7,8,3],"Dawncaller":[8,0,2],"Dirgeweaver":[8,0,1],"Spellsword":[8,0,6],"Bloodskald":[8,0,5],"Herald":[8,0,3],"Poxbane":[8,2,1],"Farslayer":[2,5,6],"Earthsinger":[8,2,6],"Honorguard":[8,2,5],"Lamentor":[8,1,6],"Hex Ranger":[8,1,5],"Enchantrix":[8,1,3],"Evoker":[8,6,5],"Spellsong":[8,6,3],"Howler":[8,5,3],"Doombringer":[4,7,9],"Executioner":[4,7,0],"Dreadnaught":[4,7,2],"Shroudmaster":[4,7,1],"Reaper":[4,7,6],"Shadehunter":[4,7,5],"Planeshifter":[4,7,3],"Blackguard":[4,9,0],"Justicar":[4,9,2],"Necromancer":[4,9,1],"Cultist":[4,9,6],"Blood Arrow":[4,9,5],"Edgewalker":[4,9,3],"Doomlord":[4,0,2],"Hordebreaker":[4,0,1],"Ravager":[4,0,6],"Dreadbow":[4,0,5],"Bloodreaver":[4,0,3],"Battlemage":[4,2,6],"Dreadstone":[4,2,5],"Demonologist":[4,1,6],"Shadestriker":[4,1,5],"Nightcloak":[4,1,3],"Spellbow":[4,6,5],"Revenant":[4,6,3],"Astral Ranger":[4,5,3],"Inquisitor":[7,9,0],"Death Warden":[7,9,2],"Assassin":[7,9,1],"Animist":[7,9,6],"Ranger":[7,9,5],"Soothsayer":[7,9,3],"Shadowblade":[7,0,1],"Hellweaver":[7,0,6],"Outrider":[7,0,5],"Darkrunner":[7,0,3],"Blighter":[7,2,0],"Shadowknight":[7,2,1],"Swiftstone":[7,2,6],"Stone Arrow":[7,2,5],"Eidolon":[7,1,3],"Trickster":[7,1,5],"Daggerspell":[7,1,6],"Enigmatist":[7,6,3],"Infiltrator":[7,6,5],"Primeval":[7,5,3],"Cleric":[9,3,8],"Argent":[9,3,0],"Hierophant":[9,3,1],"Boneweaver":[9,3,6],"Oracle":[9,3,5],"Druid":[9,5,2],"Soulbow":[9,5,1],"Naturalist":[9,5,6],"Hexblade":[0,1,2],"Hex Warden":[0,1,3],"Harbinger":[0,1,6],"Dreadhunter":[0,1,5],"Dervish":[0,1,9],"Liberator":[2,0,5],"Crusader":[0,2,6],"Paladin":[0,2,9],"Bonestalker":[0,3,5],"Enforcer":[0,3,6],"Destroyer":[0,5,6],"Warpriest":[0,5,9],"Fleshshaper":[6,9,0],"Defiler":[1,2,4],"Archon":[1,2,5],"Cabalist":[1,2,6],"Shadowbane":[1,2,9],"Arcane Hunter":[1,3,5],"Arcanist":[1,3,6],"Stormcaster":[1,5,6],"Shaman":[1,6,9],"Stormchaser":[3,5,6]};
			
			//Toggle Row
			$(document).on('click','.feed-row',function(){
				event.stopPropagation();
				$(this).toggleClass("feed-highlight").find(".feed-more").slideToggle(200);
			});
			
			//Pagination
			$(document).on('click','._feed-page',function(){
				$(this).button('loading');
				GLOBAL_PAGE++;
				archebaseFeed.init({
					element: $('#feed-content'),
					type: $(this).attr("data-type"),
					page: GLOBAL_PAGE,
					trees: GLOBAL_TREES
				});
			});
			
			//Filters - Tab
			$(document).on('click','._filter',function(){
				$("#feed-content").empty();
				$("._feed-page").button('loading').attr('data-type', $(this).attr("data-type"));
				checkTrees();
				GLOBAL_PAGE = 1;
				archebaseFeed.init({
					element: $('#feed-content'),
					type: $(this).attr("data-type"),
					page: GLOBAL_PAGE,
					trees: GLOBAL_TREES
				});
			});

			//Filters - Trees
			$(document).on('click','.list-icons i',function(){ //Filter Tree
				var trees = new Array();
				$("#feed-content").empty();
				$("._feed-page").button('loading').attr('data-type', $(this).attr("data-type"));
				
				if(!$(this).hasClass('active')){
					$(this).addClass('active');
				}
				else{
					$(this).removeClass('active');
				}
				
				$(".list-icons i.active").each(function(){
					trees.push($(this).attr("data-value"));
				});
				checkTrees();
				
				GLOBAL_TREES = trees.join(",");
				archebaseFeed.init({
					element: $('#feed-content'),
					type: $(this).attr("data-type"),
					trees: GLOBAL_TREES
				});
			});
	
			//OverWolf
			function openSubWindow(target, send){
				overwolf.windows.obtainDeclaredWindow(target, function(result){
					if (result.status == "success"){
						overwolf.windows.restore(result.window.id, function(result){
							if(send){
								window.localStorage.setItem( 'view_build', JSON.stringify( {url:send} ) );
							}
							console.log(result);
						});
					}
				});
			};
			
			function openIframe(url){
				window.open(url, "content");
			}
			
			//Class Check
			function checkTrees(){
				var value = new Array(), className = '';
				$(".list-icons i.active").each(function(){
						value.push(parseInt($(this).attr('data-value')));
				});
				if(value.length <= 3){
					$.each(classList, function(i,v){
						if( $.inArray(value[0]-1,v) != -1 && $.inArray(value[1]-1,v) != -1 && $.inArray(value[2]-1,v) != -1 ){
							className = i;
						}
					});
				}
				if(className){
					var type = $(".nav-pills>li.active>a").attr("data-original-title");
					if(!type) type = '';
					$("._class-name").empty().text(className+' '+type+' Guides');
				}
				else
					$("._class-name").empty();
			}
			
			$(function(){
				$('[data-toggle="tooltip"], .tp').tooltip();
				
				archebaseFeed.init({
					element: $('#feed-content'),
					type: 'rising'
				});
				
				$(".feed-row:first").trigger("click");
			});
		</script>
		
		<script type="text/template" id="feed-template">
			<div class="feed-row">
				<div class="feed-icons">			
					<i class="icon small t{build.Tree1.id} tp" data-toggle="tooltip" title="{build.Tree1.name}"></i>
					<i class="icon small t{build.Tree2.id} tp" data-toggle="tooltip" title="{build.Tree2.name}"></i>
					<i class="icon small t{build.Tree3.id} tp" data-toggle="tooltip" title="{build.Tree3.name}"></i>
				</div>
				<span class="feed-username">	
					<a href="/profile/{build.User.username}">{build.User.username}</a>
				</span>
				
				<span class="feed-time">{build.Build.modified}</span>
				
				<div class="feed-badges">
					<span class="fire-badge glyphicon glyphicon-fire tp" title="Hot Rising Build"></span>
					<span class="popular-badge glyphicon glyphicon-comment tp" title="Popular Build"></span>
				</div>
				
				<div class="feed-rising tp" title="Likes Last Week" data-container="body" style="display:none;">
					<span class="glyphicon glyphicon-chevron-up"></span> {build.Build.votes_rising}
				</div>
				
				<span class="feed-title">
					<a class="color-" onclick="openSubWindow('View','{build.Build.url}?url={build.Build.url}')" href="#">{build.Build.title}</a>
				</span>
				
				<span class="feed-classname">	
					{build.Build.role}
				</span>
		
				<div class="feed-info">
					<div class="feed-level tp" title="Level" data-container="body">{build.Build.level}</div>
					<div class="text-center" style="min-width: 0;">
						<span class="glyphicon glyphicon-text-width tp" data-container="body" style="color: #000; text-shadow: 0 0 2px #000;" data-html="true" title="Content score: <b><font color='#000'>{build.Build.content}</font></b>"></span>
						<!--<span class="tp updated" data-html="true">
								<span class="glyphicon glyphicon-time"></span>
						</span>-->
					</div>
					
					<div class="feed-ratings">
						<span style="color:#FFCC00">{build.Build.votes_total} votes</span><br/>
						<span class="rating tp" data-placement="right" title="{build.Build.rating}">
							<span style="width: {build.Build.rating}%;"></span>
						</span>
					</div>
					
					<div class="feed-numbers">
						<div>
							<span class="glyphicon glyphicon-eye-open" title="Views"></span> {build.Build.views}
						</div>
						<div>
							<span class="glyphicon glyphicon-comment" title="Comments"></span> {build.Build.comments}
						</div>
					</div>		
				</div>
				<div class="feed-more">
					<div class="feed-las">
						<div class="feed-las-t1"></div>
						<div class="feed-las-t2"></div>
						<div class="feed-las-t3"></div>
					</div>
				</div>
			</div>
		</script>
	</head>
	<body>
		<div id="topmenu">
			<a class="logo" href="/"><img src="logo.png" alt="ArcheBase" style=""></a>
			<ul>
				<li><a onclick="openIframe('http://arche-base.com/streams');" href="#">Streams</a></li>
				<li><a onclick="openIframe('http://arche-base.com/posts');" href="#">Releases</a></li>
				<li><a class="btn-create" href="#" onclick="openSubWindow('Generator');">Create</a></li>
			</ul>
		</div>
		
		<ul class="nav nav-pills" style="padding: 12px 0 0 12px;">
			<li class="active"><a href="#" data-toggle="tab" data-type="rising" class="_filter tp" data-toggle="tooltip" title="Rising"><span class="glyphicon glyphicon-signal"></span></a></li>
			<li><a href="#" data-toggle="tab" data-type="rating" class="_filter tp" title="Rating"><span class="glyphicon glyphicon-thumbs-up"></span></a></li>
			<li><a href="#" data-toggle="tab" data-type="comment_count" class="_filter tp" title="Popular"><span class="glyphicon glyphicon-comment"></span></a></li>
			<li><a href="#" data-toggle="tab" data-type="views" class="_filter tp" title="Views"><span class="glyphicon glyphicon-eye-open"></span></a></li>
			<li><a href="#" data-toggle="tab" data-type="content" class="_filter tp" title="Score"><span class="glyphicon glyphicon-text-height"></span></a></li>
			<li><a href="#" data-toggle="tab" data-type="" class="_filter tp" title="Updated"><span class="glyphicon glyphicon-leaf"></span></a></li>
			<!--<li><a class="home-find-guides" href="#" onclick="openIframe('http://arche-base.com/builds/search');"><span class="glyphicon glyphicon-search"></span> Find Guides</a></li>-->
		</ul>
		
		<div class="filter-trees row">
			<div class="list-icons">
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t1" data-value="1" data-original-title="Battlerage"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t2" data-value="2" data-original-title="Witchcraft"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t3" data-value="3" data-original-title="Defense"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t4" data-value="4" data-original-title="Auramancy"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t5" data-value="5" data-original-title="Occultism"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t6" data-value="6" data-original-title="Archery"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t7" data-value="7" data-original-title="Sorcery"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t8" data-value="8" data-original-title="Shadowplay"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t9" data-value="9" data-original-title="Songcraft"></i>
				</div>
				<div class="input checkbox">
					<i data-placement="bottom" class="tp icon thumb t10" data-value="10" data-original-title="Vitalism"></i>
				</div>
				<div class="_class-name"></div>
			</div>
		</div>
		
		<div id="feed-content"></div>
		<div id="feed-bottom">
			<button class="_feed-page btn btn-primary text-center" style="display:none;" data-loading-text="<span class='glyphicon glyphicon-refresh glyphicon-refresh-animate'></span>">See More</button>
		</div>
	</body>
</html>
